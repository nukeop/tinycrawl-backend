# tinycrawl-backend ![Travis (.org)](https://img.shields.io/travis/nukeop/tinycrawl-backend.svg?style=for-the-badge) [![ReadTheDocs Status for tinycrawl](https://img.shields.io/readthedocs/tinycrawl.svg?style=for-the-badge)](http://tinycrawl.readthedocs.io/en/latest/)
Backend for the tinycrawl phaser game

## Getting started

#### Running the server
To run, clone the repository, edit `server/config.js` with your mongodb credentials, and run the following command:
```shell
$ npm install && npm start
```

#### Building Docker image
There is an included Dockerfile that builds the image reliably. To use it, clone the repository, and then run this:
```shell
$ docker -t tinycrawl-backend .
```

You can also build an ARM image using the other Dockerfile. To build it on a x86 PC:
```shell
$ docker run --rm --privileged multiarch/qemu-user-static:register --reset
$ docker build -t nukeop/tinycrawl-backend-rpi -f Dockerfile_arm .
```

## API

### Rules

-   Endpoints are idempotent where it makes sense.
-   Endpoints that modify a resource will return the new modified resource.
-   POST parameters will be passed in body as JSON.

### Authentication

Authentication is done by [basic access authentication](https://en.wikipedia.org/wiki/Basic_access_authentication).
Use the `Authorization` header to provide your username and password. If you provide that data and it corresponds to an existing user, you're authenticated. If you don't, you're not.

The header should contain:
* the method (currently the only valid value is `Basic`)
* a single space
* base64-encoded string containing the username and the password combined with a colon (`username:password`)

Example: `Basic dGVzdDI6dGVzdA==`

## API Endpoints

#### Resources

Lists all available resources.

Route | HTTP Verb | Definition
------|-----------|---------------------------------------
/     | **GET**   | Get a list of all available resources.

#### Definitions

Contains definitions of resource types. Think character classes, environment types, weapon components, and so on.

Route                                    | HTTP Verb | Description
-----------------------------------------|-----------|------------------------------------------
/definitions/heroes                      | **GET**   | Get a list of all hero types.
/definitions/heroes/:name                | **GET**   | Get a single hero type.
/definitions/environments                | **GET**   | Get a list of all environments.
/definitions/environments/:name          | **GET**   | Get a single environment.
/definitions/moves                       | **GET**   | Get a list of all moves.
/definitions/moves/:name                 | **GET**   | Get a single move.
/definitions/environmentalFeatures       | **GET**   | Get a list of all environmental features.
/definitions/environmentalFeatures/:name | **GET**   | Get a single environmental feature.
/definitions/abilities                   | **GET**   | Get a list of all abilities.
/definitions/abilities/:name             | **GET**   | Get a single ability.

#### Users

Contains user-related data. The only identifier required to select a particular user is the user's uuid, generated by the initial POST request.

Route                     | HTTP Verb  | Description
--------------------------|------------|-------------------------------------------------------------------------------------
/users                    | **POST**   | Create a new user. Returns the new User object.
/users                    | **GET**    | Get a list of all users.
/users/:uuid              | **GET**    | Get a single user.
/users/username/:username | **GET**    | Get a single user by username.
/users/:uuid              | **DELETE** | Delete a single user.
/users/:uuid/heroes       | **GET**    | Get all heroes of a user.
/users/:uuid/universes    | **GET**    | Get all universes of a user.
/users/:uuid/role         | **PUT**    | Update a user's role. Required body parameter: `role`, must be one of allowed roles.

#### Heroes

Contains data about characters created by users.

Route                           | HTTP Verb  | Description
--------------------------------|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
/heroes                         | **GET**    | Get a list of all heroes.
/heroes                         | **POST**   | Create a new character by using the `heroDefinition` as a base. The name of the character will be set to `name`. It will be created for the authenticated user.
/heroes/:uuid                   | **GET**    | Get a single hero.
/heroes/:uuid                   | **DELETE** | Delete a single hero.
